name: Options Test Suite
description: Test suite to verify command-line options handling. Uses bashi to test bashi.
# NOTE: These tests are using bashi to test bashi, which has a side-effect of capturing
# the output from bats rather than outputting to the terminal directly. Bats automatically
# switches to the tap formatter when its output is not a terminal, which affects the test by
# preventing the output from being tested as non-tap formatted. Therefore, all these tests 
# assume --tap output formatting.

variables:
  bashi: $(pwd)/src/bashi

tests:
  - name: Version test
    command: "{{bashi}} --version"
    exitCode: 0
    outputContains:
       - "bashi version"

  - name: Help test
    command: "{{bashi}} --help"
    exitCode: 0
    outputContains:
       - "Usage:"
       - "OPTIONS"

  - name: Help without specifying help options
    command: "{{bashi}}"
    exitCode: 2
    outputContains:
       - "Usage:"
       - "OPTIONS"

  - name: Run basic test suite
    command: "{{bashi}} ./tests/basic.bashi.yaml"
    exitCode: 0
    outputContains:
       - "Echo test with variable substitution"
       - "Exit code test"
       - "Stderr test"
  
  - name: Timings Option
    command: "{{bashi}} ./tests/basic.bashi.yaml --timing --no-color"
    exitCode: 0
    outputMatches: "in [0-9]+ms"

  