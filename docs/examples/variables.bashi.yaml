# Variable Substitution Example
# Demonstrates: User-defined variables for reusable test values
# Uses: yq, echo, and standard Unix tools

name: "Variable Substitution Example"

variables:
  YQ_QUERY: ".name"
  CONFIG_FILE: "/tmp/bashi-example-config.yaml"
  APP_NAME: "example-app"
  APP_VERSION: "1.0.0"

setup: |
  echo "name: example-app" > /tmp/bashi-example-config.yaml
  echo "version: 1.0.0" >> /tmp/bashi-example-config.yaml
  echo "author: developer" >> /tmp/bashi-example-config.yaml

teardown: |
  rm -f /tmp/bashi-example-config.yaml

tests:
  - name: "Use variable in yq query"
    command: "yq '{{YQ_QUERY}}' {{CONFIG_FILE}}"
    exitCode: 0
    outputEquals: "{{APP_NAME}}"

  - name: "Use variable in assertion"
    command: "yq '.version' {{CONFIG_FILE}}"
    exitCode: 0
    outputEquals: "{{APP_VERSION}}"

  - name: "Variables in outputContains"
    command: "yq '.' {{CONFIG_FILE}}"
    exitCode: 0
    outputContains:
      - "{{APP_NAME}}"
      - "{{APP_VERSION}}"

  - name: "Combine variables in complex command"
    command: |
      echo "Reading {{CONFIG_FILE}}"
      yq '{{YQ_QUERY}}' {{CONFIG_FILE}}
    exitCode: 0
    outputContains:
      - "Reading"
      - "{{APP_NAME}}"
