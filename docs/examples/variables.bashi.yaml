# Variable Substitution Example
# Demonstrates: User-defined variables and environment variables
# Uses: yq, echo, and standard Unix tools

name: "Variable Substitution Example"

variables:
  YQ_QUERY: ".name"
  CONFIG_FILE: "/tmp/bashi-example-config.yaml"
  USER_HOME: "{{env.HOME}}"
  SHELL_PATH: "{{env.SHELL}}"

setup: |
  cat > /tmp/bashi-example-config.yaml << 'EOF'
  name: example-app
  version: 1.0.0
  author: developer
  EOF

teardown: |
  rm -f /tmp/bashi-example-config.yaml

tests:
  - name: "Use variable in yq query"
    command: "yq '{{YQ_QUERY}}' {{CONFIG_FILE}}"
    exitCode: 0
    outputEquals: "example-app"

  - name: "Access environment variable for home directory"
    command: "echo \"Home: {{USER_HOME}}\""
    exitCode: 0
    outputContains:
      - "Home:"
      - "/"

  - name: "Access shell path from environment"
    command: "echo \"Shell: {{SHELL_PATH}}\""
    exitCode: 0
    outputContains:
      - "Shell:"

  - name: "Combine variables in complex command"
    command: |
      echo "Reading {{CONFIG_FILE}}"
      yq '{{YQ_QUERY}}' {{CONFIG_FILE}}
    exitCode: 0
    outputContains:
      - "Reading"
      - "example-app"
