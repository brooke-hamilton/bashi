# Variable Substitution Example
# Demonstrates: User-defined variables for reusable test values
# Uses: yq, echo, and standard Unix tools

name: "Variable Substitution Example"

variables:
  YQ_QUERY: ".name"
  APP_NAME: "example-app"
  APP_VERSION: "1.0.0"

setup: |
  echo "name: example-app" > "$TEST_TEMP_DIR/config.yaml"
  echo "version: 1.0.0" >> "$TEST_TEMP_DIR/config.yaml"
  echo "author: developer" >> "$TEST_TEMP_DIR/config.yaml"

tests:
  - name: "Use variable in yq query"
    command: "yq '{{YQ_QUERY}}' \"$TEST_TEMP_DIR/config.yaml\""
    exitCode: 0
    outputEquals: "{{APP_NAME}}"

  - name: "Use variable in assertion"
    command: "yq '.version' \"$TEST_TEMP_DIR/config.yaml\""
    exitCode: 0
    outputEquals: "{{APP_VERSION}}"

  - name: "Variables in outputContains"
    command: "yq '.' \"$TEST_TEMP_DIR/config.yaml\""
    exitCode: 0
    outputContains:
      - "{{APP_NAME}}"
      - "{{APP_VERSION}}"

  - name: "Combine variables in complex command"
    command: |
      echo "Reading config from $TEST_TEMP_DIR"
      yq '{{YQ_QUERY}}' "$TEST_TEMP_DIR/config.yaml"
    exitCode: 0
    outputContains:
      - "Reading"
      - "{{APP_NAME}}"
