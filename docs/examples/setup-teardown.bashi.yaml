# Setup and Teardown Example
# Demonstrates: Lifecycle hooks for test environment preparation
# Uses: yq, standard Unix file operations

name: "Setup and Teardown Example"

setup: |
  export TEST_DIR=$(mktemp -d)
  echo "Test environment: $TEST_DIR"

teardown: |
  rm -rf "$TEST_DIR"
  echo "Cleanup complete"

setupEach: |
  cd "$TEST_DIR"
  cat > config.yaml << 'EOF'
  app: testapp
  env: testing
  EOF

teardownEach: |
  rm -f config.yaml

tests:
  - name: "Config file exists in temp dir"
    command: "ls \"$TEST_DIR/config.yaml\""
    exitCode: 0

  - name: "Can read YAML config with yq"
    command: "yq '.app' \"$TEST_DIR/config.yaml\""
    exitCode: 0
    outputEquals: "testapp"

  - name: "Can modify and verify YAML"
    command: |
      yq -i '.env = "production"' "$TEST_DIR/config.yaml"
      yq '.env' "$TEST_DIR/config.yaml"
    exitCode: 0
    outputEquals: "production"
